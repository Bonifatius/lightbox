(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t,i){var o,n;this.elements=t,this.padding=null!=i?i:16,this.click=e(this.click,this),this.keyup=e(this.keyup,this),this.elements.addClass("lightbox-image"),this.elements.click(this.click),$("body").css("position","relative"),this.background=$('<div class="lightbox-background"></div>').appendTo($("body")),this.background.click(function(t){return function(){return t.collapse(!0)}}(this)),this.icons=[],this.elements.length>1&&(n=$('<a class="lightbox-previous" href="/"></a>').appendTo($("body")),n.click(function(t){return function(){return t.show(!1)}}(this)),this.icons.push(n),o=$('<a class="lightbox-next" href="/"></a>').appendTo($("body")),o.click(function(t){return function(){return t.show(!0)}}(this)),this.icons.push(o)),$(window).resize(function(t){return function(){return t.collapse(!1)}}(this)),$(window).scroll(function(t){return function(){return Math.abs($(window).scrollTop()-t.scroll_top||$(window).scrollTop())>t.padding?t.collapse(!0):void 0}}(this)),$(window).keyup(this.keyup)}return t.prototype.keyup=function(t){var e,i;return 27===t.keyCode&&this.collapse(!0),(39===(e=t.keyCode)||74===e)&&this.show(!0),37===(i=t.keyCode)||75===i?this.show(!1):void 0},t.prototype.show=function(t){var e,i,o,n,s,a;for(null==t&&(t=!0),a=this.elements,i=n=0,s=a.length;s>n;i=++n)if(e=a[i],$(e).hasClass("lightbox-image-opened")){o=i;break}return null!=o&&(e=$(this.elements[o]),e.removeClass("lightbox-image-animate"),e.removeClass("lightbox-image-opened"),e.css("z-index","auto"),this.zoom(e,"translate(0, 0) scale(1, 1)"),o=t?(o+1)%this.elements.length:(o-1+this.elements.length)%this.elements.length,e=$(this.elements[o]),e.removeClass("lightbox-image-animate"),this.maximize(e)),!1},t.prototype.maximize=function(t){var e,i,o,n,s,a,r,l,h,u,c,d,m,g,p;for(this.scroll_top=$(window).scrollTop(),n=t.width(),i=t.height(),o=n/i,c=$(window).width()-2*this.padding,h=$(window).height()-2*this.padding,0/0!==Number(t.attr("data-max-width"))&&(c=Math.min(c,Number(t.attr("data-max-width")))),0/0!==Number(t.attr("data-max-height"))&&(h=Math.min(h,Number(t.attr("data-max-height")))),u=c/h,u>o?c=Math.round(h*o):h=Math.round(c/o),s=c/n,a=h/i,r=Math.round($(window).scrollLeft()+.5*$(window).width()-t.offset().left-.5*n)-(n+c)%2*.5,l=Math.round($(window).scrollTop()+.5*$(window).height()-t.offset().top-.5*i)-(i+h)%2*.5,this.clear(),t.addClass("lightbox-image-opened"),t.css("z-index",1),this.load(t),this.background.addClass("lightbox-background-show"),this.zoom(t,"translate("+r+"px, "+l+"px) scale("+s+", "+a+")"),g=this.icons,p=[],d=0,m=g.length;m>d;d++)e=g[d],p.push($(e).show());return p},t.prototype.minimize=function(t,e){var i,o,n,s,a;for(null==e&&(e=!0),t.removeClass("lightbox-image-opened"),this.background.removeClass("lightbox-background-show"),e&&(this.background.addClass("lightbox-background-close"),setTimeout(function(t){return function(){return t.background.removeClass("lightbox-background-close")}}(this),250)),this.zoom(t,"translate(0, 0) scale(1, 1)"),s=this.icons,a=[],o=0,n=s.length;n>o;o++)i=s[o],a.push($(i).hide());return a},t.prototype.zoom=function(t,e){return t.css({"-webkit-transform":e,"-moz-transform":e,transform:e})},t.prototype.click=function(t){var e;return e=$(t.target),e.addClass("lightbox-image-animate"),e.hasClass("lightbox-image-opened")?this.minimize(e):this.maximize(e)},t.prototype.clear=function(){var t,e,i,o,n;for(o=this.elements,n=[],e=0,i=o.length;i>e;e++)t=o[e],n.push($(t).css("z-index","auto"));return n},t.prototype.collapse=function(t){var e,i,o,n,s;for(null==t&&(t=!0),n=this.elements,s=[],i=0,o=n.length;o>i;i++)e=n[i],e=$(e),e.hasClass("lightbox-image-opened")?(t?e.addClass("lightbox-image-animate"):e.removeClass("lightbox-image-animate"),s.push(this.minimize(e,t))):s.push(void 0);return s},t.prototype.load=function(t){return t.attr("data-image-large")&&!t.attr("data-image-large-replaced")?(t.css("background-image","url('"+t.attr("src")+"')"),t.load(function(){return $(this).css("background-image","none")}),t.attr("src",t.attr("data-image-large")),t.attr("data-image-large-replaced","true")):void 0},t}(),$(function(){return Modernizr.csstransforms?new t($("img")):void 0})}).call(this);